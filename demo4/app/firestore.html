<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Authentication with Firestore</title>

    <style>
        .email-logado {
            text-decoration: underline;
        }

        .code-field {
            display: none;
        }
    </style>

</head>

<body>
    <div id="recaptcha-container"></div>
    <h1>Authentication with Firestore</h1>

    <fieldset>
        <legend>Cadastre-se</legend>


        <section class="sem-login">
            <input type="text" name="name" placeholder="Nome">
            <input type="text" name="description" placeholder="Descrição">
            <input type="email" name="email" placeholder="E-mail">
            <input type="password" name="password" placeholder="Senha">

            <button name="register">Criar conta</button>
            <!-- <button name="login">Login</button> -->
        </section>
    </fieldset>


    <fieldset>
        <legend>Entrar</legend>

        <section class="sem-login">
            <input type="email" name="login-email" placeholder="E-mail">
            <input type="password" name="login-password" placeholder="Senha">

            <button name="sign-in">Entrar</button>
            <!-- <button name="login">Login</button> -->
        </section>
    </fieldset>




    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script defer src="https://www.gstatic.com/firebasejs/6.2.0/firebase-app.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/6.2.0/firebase-auth.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/6.2.0/firebase-firestore.js"></script>


    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // console.log(firebase);
            // Your web app's Firebase configuration
            var firebaseConfig = {
            };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);

            const buttonCreateAccount = document.querySelector('button[name=register]');
            buttonCreateAccount.addEventListener('click', () => {
                const formData = {
                    email: document.querySelector('input[name=email]').value,
                    senha: document.querySelector('input[name=password]').value,
                    name: document.querySelector('input[name=name]').value,
                    description: document.querySelector('input[name=description]').value,
                };

                firebase.auth().createUserWithEmailAndPassword(formData.email, formData.senha)
                    .then(data => {
                        console.log(formData);
                        const user = data.user;
                        const uid = user.uid;

                        const users = firebase.firestore().collection('users');
                        users.doc(uid).set({
                            email: formData.email, name: formData.name, description: formData.description
                        });

                        alert('Conta criada com sucesso');


                    })
                    .catch(error => {
                        if (error.code == 'auth/email-already-in-use') {
                            alert('Esse e-mail já está em uso por outro usuário')
                        } else {
                            alert(error.message);
                        }
                        console.log(error);
                    });
            });


            // LOGIN DO USUARIO
            const buttonLogin = document.querySelector('button[name=sign-in]');
            buttonLogin.addEventListener('click', () => {
                const formData = {
                    email: document.querySelector('input[name=login-email]').value,
                    senha: document.querySelector('input[name=login-password]').value,
                };

                firebase.auth().signInWithEmailAndPassword(formData.email, formData.senha).then(async (data) => {
                    const uid = data.user.uid;
                    const doc = await firebase.firestore().doc(`users/${uid}`).get();
                    console.log(doc.data());
                });
            });
        });



    </script>

    <script>





        // const checkUser = () => {
        //     firebase.auth().onAuthStateChanged(function(user) {
        //         if (user) {
        //          console.log(user);
        //          document.querySelector('.sem-login').style.display='none';
        //          document.querySelector('.logado').style.display='initial';

        //          let text = '';

        //          if(user.displayName){
        //             text = user.displayName + ' - ['+ user.email +']';
        //          }else{
        //              if(user.phoneNumber) {
        //                 text = user.phoneNumber;
        //              }else {
        //                 text = user.email;
        //              }
        //          }

        //          document.querySelector('.email-logado').innerText = text;
        //         } else {
        //             document.querySelector('.logado').style.display='none';
        //             document.querySelector('.sem-login').style.display='initial';
        //             document.querySelector('.email-logado').innerText = '';
        //         }
        //     });
        // };



        //     // Initialize Firebase
        //     var config = {
        //         apiKey: "AIzaSyD3tdHh9wYdpPkuP4YGnjkUYeETfct-CiI",
        //         authDomain: "happy-todolist.firebaseapp.com",
        //         databaseURL: "https://happy-todolist.firebaseio.com",
        //         projectId: "happy-todolist",
        //         storageBucket: "happy-todolist.appspot.com",
        //         messagingSenderId: "1025858187095"
        //     };
        //     firebase.initializeApp(config);

        //     checkUser();

        //     const buttonCreateAccount = document.querySelector('button[name=criar-conta]');
        //     const buttonLogin = document.querySelector('button[name=login]');
        //     const buttonLoginGoogle = document.querySelector('button[name=login-google]');
        //     const buttonLoginFacebook = document.querySelector('button[name=login-facebook]');
        //     const buttonLoginFone = document.querySelector('button[name=login-fone]');

        //     buttonLogin.addEventListener('click', function(){
        //         const data = {
        //             email: document.querySelector('input[name=email]').value,
        //             senha: document.querySelector('input[name=senha]').value
        //         };

        //         firebase.auth().signInWithEmailAndPassword(data.email, data.senha)
        //             .catch(loginError => {
        //                 console.log(loginError);
        //                 alert('Falha no login');
        //             });


        //     }, false);

        //     document.querySelector('.logout').addEventListener('click', function(){
        //         firebase.auth().signOut()
        //             .then(data => {

        //             });
        //     }, false);

        //     buttonCreateAccount.addEventListener('click', function(){
        //         const data = {
        //             email: document.querySelector('input[name=email]').value,
        //             senha: document.querySelector('input[name=senha]').value
        //         };

        //         firebase.auth().createUserWithEmailAndPassword(data.email, data.senha)
        //             .then(data => {
        //                 alert('Conta criada com sucesso');
        //                 console.log(data);

        //             })
        //             .catch(error => {
        //                 if(error.code == 'auth/email-already-in-use') {
        //                     alert('Esse e-mail já está em uso por outro usuário')
        //                 }else{
        //                     alert(error.message);
        //                 }
        //                 console.log(error);
        //             });
        //     }, false);



        //     /// TELEFONE

        //     window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
        //         'size': 'invisible'
        //     });




        //     buttonLoginFone.addEventListener('click', function(){
        //         firebase.auth().languageCode = 'pt_BR';

        //         var phoneNumber = document.querySelector('input[name=telefone]').value;
        //         var appVerifier = window.recaptchaVerifier;
        //         firebase.auth().signInWithPhoneNumber(phoneNumber, appVerifier)
        //             .then(function (confirmationResult) {
        //                 window.confirmationResult = confirmationResult;
        //             }).catch(function (error) {
        //                 window.recaptchaVerifier.render().then(function(widgetId) {
        //                    grecaptcha.reset(widgetId);
        //                 });
        //             });

        //         }, false);


        //     //confirmando
        //     document.querySelector('button[name=confirmar]').addEventListener('click', function() {
        //         const codigo = document.querySelector('input[name=codigo]').value;
        //         if(window.confirmationResult) {
        //             window.confirmationResult.confirm(codigo)
        //                 .then(user => {
        //                     alert('Tudo certo :)');
        //                 }).catch(err => {
        //                     alert("Houve um erro.\nCertifique-se de que informou o código corretamente");
        //                 });
        //         }
        //         console.log(window.confirmationResult);
        //     }, false);





        //     /// REDES SOCIAIS

        //     buttonLoginGoogle.addEventListener('click', function() {
        //         const provider = new firebase.auth.GoogleAuthProvider();
        //         provider.addScope('https://www.googleapis.com/auth/contacts.readonly');
        //         provider.addScope('https://www.googleapis.com/auth/userinfo.email');
        //         provider.addScope('https://www.googleapis.com/auth/userinfo.profile');
        //         firebase.auth().languageCode = 'pt_BR';

        //         firebase.auth().signInWithPopup(provider)
        //             .then(result => {
        //                 const token = result.credential.accessToken;
        //                 const user = result.user;

        //                 console.log(user);
        //             }).catch(err => {
        //                 alert('Houve um erro');
        //                 console.log({googleError: err});
        //             });
        //     }, false);


        //     buttonLoginFacebook.addEventListener('click', function() {
        //         const provider = new firebase.auth.FacebookAuthProvider();
        //         provider.addScope('email');
        //         provider.addScope('user_birthday');
        //         provider.addScope('user_friends');

        //         firebase.auth().languageCode = 'pt_BR';

        //         firebase.auth().signInWithPopup(provider)
        //             .then(result => {
        //                 const token = result.credential.accessToken;
        //                 const user = result.user;

        //                 console.log(user);
        //             }).catch(err => {
        //                 alert('Houve um erro');
        //                 console.log({googleError: err});
        //             });
        //     }, false);






    </script>
</body>

</html>